<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>Filters</title>
	</head>
		<canvas id="canvas" width="900" height="600" style="border:#000 solid 1px;" />
	</body>
	<script>
	var ctx = document.getElementById("canvas").getContext("2d");

			function binaire(image){
				var line = 0;
				var count = 0;

				ctx.drawImage(image,0,0);
			 imageData = ctx.getImageData(0,0,image.width,image.height);
			 for (x=0; x<imageData.width; x++){
			 for (y = 0 ; y < imageData.height; y++){ //la idea del for es que se sumen todos los grises de la imagen
				 line += (getRed(imageData,x,y) + getGreen(imageData,x,y) + getBlue(imageData,x,y))/3;
				 count++;
			 }
		 }
		 line = line/count; //y acÃ¡ sacamos el promedio de gris total de la imagen y en base a esto, trazamos la linea para saber cuales pixeles van blanco y cuales negro
			 for (x=0; x<imageData.width; x++){
				for (y = 0 ; y < imageData.height; y++){
					var grey = (getRed(imageData,x,y) + getGreen(imageData,x,y) + getBlue(imageData,x,y))/3;
					if(grey > line){
						setPixel(imageData, x, y, 255, 255,255, 255);

					}else{
						setPixel(imageData, x, y, 0, 0,0, 255);
					}
				}
			}
			 ctx.putImageData(imageData,0,0);
			}
			function greyScale(image){
				ctx.drawImage(image,0,0);
			 imageData = ctx.getImageData(0,0,image.width,image.height);
			 for (x=0; x<imageData.width; x++){
				for (y = 0 ; y < imageData.height; y++){
					var grey = (getRed(imageData,x,y) + getGreen(imageData,x,y) + getBlue(imageData,x,y))/3;
					setPixel(imageData, x, y, grey, grey,grey, 255);
				}
			}
			 ctx.putImageData(imageData,0,0);
			}

			function lineDrawer(image){
				ctx.drawImage(image,0,0);
			 imageData = ctx.getImageData(0,0,image.width,image.height);
			  for (x=0; x<imageData.width; x++){
				for (y = 0 ; y < imageData.height; y++){
					var grey = (getRed(imageData,x,y) + getGreen(imageData,x,y) + getBlue(imageData,x,y))/3;
					var greyNext = (getRed(imageData,x+4,y+4) + getGreen(imageData,x+4,y+4) + getBlue(imageData,x+4,y+4))/3;
					if(grey+15 < greyNext){
						//setPixel(imageData, x, y,getRed(imageData,x,y)*0.3 , getGreen(imageData,x,y)*0.3 , getBlue(imageData,x,y)*0.3, 255);
						setPixel(imageData, x, y,0 ,0 , 0, 255);
					}else{
						setPixel(imageData, x, y,255 ,255 , 255, 255);
					}

			}
			 ctx.putImageData(imageData,0,0);
			}
		}
		function diffuser(image){
			ctx.drawImage(image,0,0);
		 imageData = ctx.getImageData(0,0,image.width,image.height);
		 for (var i = 0; i < 2; i++) {


		 for (x=0; x<imageData.width; x++){
			for (y = 0 ; y < imageData.height; y++){
					setPixel(imageData, x, y,(getRed(imageData,x-4,y) +getRed(imageData,x,y) +getRed(imageData,x+4,y))/3, (getGreen(imageData,x-4,y) +getGreen(imageData,x,y) +getGreen(imageData,x+4,y))/3, (getBlue(imageData,x-4,y) +getBlue(imageData,x,y) +getBlue(imageData,x+4,y))/3, 255);
 			}
			}
		}

		 ctx.putImageData(imageData,0,0);

	}
			 function negative(image){
				 ctx.drawImage(image,0,0);
				imageData = ctx.getImageData(0,0,image.width,image.height);
				for (x=0; x<imageData.width; x++){
				 for (y = 0 ; y < imageData.height; y++){
					 setPixel(imageData, x, y, 255-getRed(imageData,x,y), 255-getGreen(imageData,x,y),255-getBlue(imageData,x,y), 255);
				 }
			 }
				ctx.putImageData(imageData,0,0);
			 }
			 function original(image){
				ctx.drawImage(image,0,0);
			 imageData = ctx.getImageData(0,0,image.width,image.height);
			 for (x=0; x<imageData.width; x++){
				for (y = 0 ; y < imageData.height; y++){
					setPixel(imageData, x, y, getRed(imageData,x,y), getGreen(imageData,x,y),getBlue(imageData,x,y), 255);
				}
			}
			 ctx.putImageData(imageData,0,0);
			}

			 var image1 = new Image();
			 image1.src = "img/playground.jpg";
			 image1.onload = function(){
				//original(this);//OK
				//negative(this);//OK
				// greyScale(this);//OK
				 //binaire(this);//OK
				 //lineDrawer(this);//OK
				diffuser(this);//OK
			 }
			 function getRed(imageData,x,y){
				 index = (x+y*imageData.width) * 4;
				 return imageData.data[index+0];
			 }
			 function getGreen(imageData,x,y){
				index = (x+y*imageData.width) * 4;
				return imageData.data[index+1];
			}
			function getBlue(imageData,x,y){
				index = (x+y*imageData.width) * 4;
				return imageData.data[index+2];
			}
			 function setPixel (imageData, x, y, r, g, b,a){
				 index = (x + y * imageData.width) * 4;
				 imageData.data[index+0] = r;
				 imageData.data[index+1] = g;
				 imageData.data[index+2] = b;
				 imageData.data[index+3] = a;

			 }
	</script>
</html>
